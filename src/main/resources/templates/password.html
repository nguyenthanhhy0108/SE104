<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Password Verification - Pocket Garage</title>
    <link  rel="stylesheet" th:href="@{/css/style.css}" />
    <link  rel="stylesheet" th:href="@{/css/password.css}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<!--test fetch API, xoá đại cái script này đi cũng đc-->


<body>
<div class="container-lg p-0">
    <div class="scrollbar_content p-4 min-vh-100 d-flex">
        <div class="w-100">
            <div class="column align-items-center">
                <div class="logo-area">
                    <a class="logo">
                        <img src="/images/logo_white.png" height="150" alt="logo">
                    </a>
                </div>

                <dialog id="dialog">
                    <h2 id="dialogTitle"></h2>
                    <p id="dialogContent"></p>
                </dialog>

                <div class="gap-10">
                </div>

                <form method="POST" th:action="@{/password}" id="verification_email_form">
                    <!-- Mail Box -->
                    <input type="hidden" name="formId" value="form1">
                    <!-- Mail Box -->
                    <div id="mail-box" class="row align-items-center justify-content-center" style="display: flex;">
                        <h3 style="margin: 2%;"> Enter your mail and we will send you a verification code</h3>
                        <div class="input_container justify-content-center align-items-center column">
                            <div class="row" style="width: 100%;">
                                <p style="margin: 0;">Your username:   </p>
                                <div class="gap-2" style="width: 2vw;"></div>
                                <input name="username" class="mail-input" type="text" id="username" style="height: 40%; width: 80%;" required>
                            </div>
                            <div class="gap-2"></div>
                            <div class="row" style="width: 100%;">
                                <p style="margin: 0;">Your ema  il:  </p>
                                <div style="width: 4.5vw;"></div>
                                <input name="email" class="mail-input" type="email" id="mail" style="height: 40%; width: 80%;" required>
                            </div>
                            <button style="width: 15%; margin-top: 10px;" class="active" type="submit" value="Send code" id="send_code" onclick="showLoading()">Send code</button>

                            <div class="loading-overlay">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                    <p><span class="msg" id="notExist"></span></p>
                    <p><span class="msg" id="notMatch"></span></p>
                    <input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
                </form>


                <!-- Enter Code -->
                <div id="veri-box" class="column align-items-center justify-content-center" style="display: none;">
                    <header>
                        <i class="material-symbols-outlined">verified_user</i>
                    </header>
                    <h2>Enter Verification Code</h2>
                    <p>We have just sent a verification code to <i style="color: #0e4bf1"><span id="email"></span></i> to reset password for <i style="color: #0e4bf1"><span id="username_sent"></span></i></p>
                    <form action="/password" method="POST" id="verification_code_form">
                        <input type="hidden" name="formId" value="form2">
                        <div class="input_field">
                            <input type="text" name="char1">
                            <input type="text" name="char2" disabled/>
                            <input type="text" name="char3" disabled/>
                            <input type="text" name="char4" disabled/>
                        </div>
                        <input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
                        <!--                        Không thể sử dụng được button-->
                        <button id="verify" type="submit" value="Verify code">Verify code</button>
                    </form>
                    <p><span class="msg" id="expiredCode"></span></p>
                    <p><span class="msg" id="wrongCode"></span></p>
                    <p>If your verification code is expired click <a href="/password">here</a> to resend</p>
                </div>

                <!-- Reset Password -->
                <div id="reset-pass" class="row align-items-center justify-content-center" style="display: none;">
                    <h3 style="margin: 1% 0 0 0;"> Reset your password</h3>
                    <form action="/password" method="POST" id="change_password_form">
                        <input type="hidden" name="formId" value="form3">
                        <div class="input_container ">
                            <div class="row justify-content-center align-items-center">
                                <h4 style="margin: 0 8% 0 0;">New password</h4>
                                <input class="pass-input" type="password" id="password" style="height: 20%; width: 80%;" oninput="checkPasswordMatch()" required>
                            </div>
                            <div class="gap-2"></div>
                            <div class="row justify-content-center align-items-center">
                                <h4 style="margin: 0 4% 0 0;">Confirm password</h4>
                                <input class="pass-input" type="password" id="password_re" style="height: 20%; width: 80%;" oninput="checkPasswordMatch()" required>
                            </div>
                        </div>
                        <div class="column"></div>
                        <div class="msg" id="passwordMatchMessage" style="display: none"></div>
                        <input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
                        <button id="confirm" class="active" onclick="resetPassword()">Confirm</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script type="text/javascript" th:src="@{/js/all.js}" defer></script>
<script type="text/javascript" th:src="@{/js/password.js}" defer></script>
</body>
</html>
